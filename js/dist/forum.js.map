{"version":3,"file":"forum.js","sources":["../src/forum/components/PlatformSelect.tsx","../src/forum/components/LoanApplicationForm.tsx","../src/forum/components/ApprovedApplicationsList.tsx","../src/forum/components/LoanApplicationPage.tsx","../src/common/models/LoanPlatform.ts","../src/common/models/LoanApplication.ts","../src/common/models/LoanVirtualApproval.ts","../src/forum/index.ts"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport m, { VnodeDOM } from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype PlatformSelectAttrs = {\n  platforms: LoanPlatform[];\n  value: string;\n  onchange: (val: string) => void;\n};\n\nexport default class PlatformSelect extends Component<PlatformSelectAttrs> {\n  private open = false;\n\n  oncreate(vnode: VnodeDOM) {\n    super.oncreate(vnode);\n    document.addEventListener('click', this.handleDocClick);\n  }\n\n  onremove(vnode: VnodeDOM) {\n    super.onremove(vnode);\n    document.removeEventListener('click', this.handleDocClick);\n  }\n\n  view() {\n    const { platforms = [], value } = this.attrs as PlatformSelectAttrs;\n    const list = Array.isArray(platforms)\n      ? platforms.filter((p) => p && typeof (p as any).id === 'function' && (p as any).id() != null)\n      : [];\n    const selected = list.find((p) => String(p.id()) === value) || null;\n\n    return (\n      <div className=\"LoanPlatformSelector\">\n        <div className=\"LoanPlatformSelector-dropdown\" onclick={(e: MouseEvent) => { e.stopPropagation(); this.toggle(); }}>\n          <div className=\"LoanPlatformSelector-selected\">\n            <div className=\"LoanPlatformSelector-info\">\n              <div className=\"LoanPlatformSelector-icon\">\n                {selected ? (\n                  <img className=\"PlatformIcon PlatformIcon--medium\" src={selected.logoUrl()} alt={selected.name()} />\n                ) : (\n                  <span className=\"PlatformIcon PlatformIcon--medium PlatformIcon--placeholder\"></span>\n                )}\n              </div>\n              <div className=\"LoanPlatformSelector-details\">\n                <div className=\"LoanPlatformSelector-name\">{selected ? selected.name() : '请选择平台'}</div>\n              </div>\n            </div>\n            <i className={`LoanPlatformSelector-dropdownIcon fas fa-chevron-${this.open ? 'up' : 'down'}`}></i>\n          </div>\n        </div>\n\n        {this.open && (\n          <div className=\"LoanPlatformSelector-dropdownMenu\" onclick={(e: MouseEvent) => e.stopPropagation()}>\n            {list.length === 0 ? (\n              <div className=\"LoanPlatformSelector-dropdownItem LoanPlatformSelector-noData\">暂无可选平台</div>\n            ) : (\n              list.map((p, index) => (\n                <div\n                  key={String((p as any).id() ?? index)}\n                  className=\"LoanPlatformSelector-dropdownItem\"\n                  onclick={() => this.select(String((p as any).id()))}\n                >\n                  <div className=\"LoanPlatformSelector-icon\">\n                    <img className=\"PlatformIcon PlatformIcon--small\" src={(p as any).logoUrl()} alt={(p as any).name()} />\n                  </div>\n                  <div className=\"LoanPlatformSelector-name\">{(p as any).name()}</div>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  private toggle() {\n    this.open = !this.open;\n    m.redraw();\n  }\n\n  private handleDocClick = () => {\n    if (this.open) {\n      this.open = false;\n      m.redraw();\n    }\n  };\n\n  private select(val: string) {\n    (this.attrs as PlatformSelectAttrs).onchange(val);\n    this.open = false;\n    m.redraw();\n  }\n}\n\n\n","// js/src/forum/components/LoanApplicationForm.tsx\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport PlatformSelect from './PlatformSelect';\nimport Stream from 'flarum/common/utils/Stream';\nimport m,{Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype LoanApplicationFormAttrs = {\n  platforms: LoanPlatform[];\n  onSubmit: (payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }) => Promise<void> | void;\n};\n\nexport default class LoanApplicationForm extends Component<LoanApplicationFormAttrs> {\n  private platformId: any;\n  private sponsorAccount: any;\n  private applicantAccount: any;\n  private loading: boolean = false;\n  private listLoading: boolean = false;\n  private myApplications: LoanApplication[] = [];\n\n  oninit(vnode: Vnode) {\n    console.log('[LoanApplicationForm] 组件初始化开始', vnode);\n    super.oninit(vnode);\n\n    this.platformId = Stream('');\n    this.sponsorAccount = Stream('');\n    this.applicantAccount = Stream('');\n    this.loading = false;\n    this.listLoading = true;\n    this.myApplications = [];\n\n    console.log('[LoanApplicationForm] 属性设置完成，开始加载我的申请记录');\n    this.loadMyApplications();\n  }\n\n  view() {\n    console.log('[LoanApplicationForm] 渲染view，状态:', {\n      loading: this.loading,\n      listLoading: this.listLoading,\n      myApplicationsCount: this.myApplications.length,\n      platformId: this.platformId(),\n      sponsorAccount: this.sponsorAccount(),\n      applicantAccount: this.applicantAccount()\n    });\n\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    console.log('[LoanApplicationForm] 传入的平台数据:', platforms);\n\n    const selectedPlatform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n    console.log('[LoanApplicationForm] 选中的平台:', selectedPlatform);\n\n    return (\n      <div className=\"LoanApplicationForm\">\n        <div className=\"Form-group\">\n          <label>选择平台</label>\n          <PlatformSelect\n            platforms={platforms}\n            value={this.platformId()}\n            onchange={this.platformId}\n          />\n        </div>\n\n        <div className=\"Form-twoInputs\">\n          <div className=\"Form-group\">\n            <label>赞助平台账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.sponsorAccount()}\n              oninput={(e: InputEvent) => this.sponsorAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：平台用户名/ID\"\n            />\n            <Button\n              className=\"Button\"\n              disabled={!selectedPlatform || !selectedPlatform.sponsorLinkUrl?.()}\n              onclick={this.openSponsorLink.bind(this)}\n            >\n              打开赞助平台链接\n            </Button>\n          </div>\n          <div className=\"Form-group\">\n            <label>申请账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.applicantAccount()}\n              oninput={(e: InputEvent) => this.applicantAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：论坛或应用内账号\"\n            />\n            <Button\n              className=\"Button Button--primary\"\n              loading={this.loading}\n              disabled={!this.platformId() || !this.sponsorAccount() || !this.applicantAccount()}\n              onclick={this.submit.bind(this)}\n            >\n              提交申请\n            </Button>\n          </div>\n        </div>\n        <div className=\"MyApplications\">\n          <h3>\n            {app.forum.attribute('loanLogoUrl') ? (\n              <img\n                src={app.forum.attribute('loanLogoUrl')}\n                alt=\"logo\"\n                style={{ height: '24px', verticalAlign: 'middle', marginRight: '8px' }}\n              />\n            ) : null}\n            您的申请订单\n          </h3>\n          {this.listLoading ? (\n            <div>加载中...</div>\n          ) : (\n            <div className=\"OrderList\">\n              <div className=\"OrderList-header\">\n                <span>平台</span>\n                <span>赞助账号</span>\n                <span>申请账号</span>\n                <span>状态</span>\n                <span>批准额度</span>\n              </div>\n              <div className=\"OrderList-body\">\n                {Array.isArray(this.myApplications) && this.myApplications.length > 0 ? (\n                  (this.myApplications as LoanApplication[])\n                    .filter((a) => !!a)\n                    .map((appModel: LoanApplication) => this.renderOrderRow(appModel))\n                    .filter((row) => row !== null) // 过滤掉renderOrderRow返回的null值\n                ) : (\n                  <div className=\"OrderList-empty\">暂无记录</div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  async submit(): Promise<void> {\n    if (this.loading) return;\n\n    this.loading = true;\n\n    try {\n      await (this.attrs as LoanApplicationFormAttrs).onSubmit({\n        platform_id: this.platformId(),\n        sponsor_account: this.sponsorAccount(),\n        applicant_account: this.applicantAccount()\n      });\n\n      // 重置表单\n      this.platformId('');\n      this.sponsorAccount('');\n      this.applicantAccount('');\n\n      // 重新加载我的申请记录\n      await this.loadMyApplications();\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  openSponsorLink() {\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    const platform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n    const url = platform && platform.sponsorLinkUrl ? platform.sponsorLinkUrl() : null;\n    if (url) {\n      window.open(url, '_blank');\n    }\n  }\n\n  async loadMyApplications(): Promise<void> {\n    console.log('[LoanApplicationForm] 开始加载我的申请记录...');\n    try {\n      const result = await app.store.find('loan-applications', { include: 'user,platform' }) as any;\n      console.log('[LoanApplicationForm] API返回结果:', result);\n      console.log('[LoanApplicationForm] 结果类型:', typeof result, '是否为数组:', Array.isArray(result));\n\n      // 确保结果是数组，过滤掉任何null/undefined值\n      if (Array.isArray(result)) {\n        console.log('[LoanApplicationForm] 原始数组长度:', result.length);\n        const filteredApps = result.filter(app => {\n          const isValid = app != null;\n          if (!isValid) {\n            console.warn('[LoanApplicationForm] 发现null/undefined应用记录:', app);\n          }\n          return isValid;\n        });\n        this.myApplications = filteredApps;\n        console.log('[LoanApplicationForm] 过滤后数组长度:', filteredApps.length);\n\n        // 检查每个应用记录的详细信息\n        filteredApps.forEach((app, index) => {\n          console.log(`[LoanApplicationForm] 应用记录 ${index}:`, {\n            id: app.id?.(),\n            platform: app.platform?.(),\n            platformMethod: typeof app.platform,\n            sponsorAccount: app.sponsorAccount?.(),\n            applicantAccount: app.applicantAccount?.(),\n            status: app.status?.(),\n            approvedAmount: app.approvedAmount?.()\n          });\n        });\n      } else {\n        console.warn('[LoanApplicationForm] API返回的不是数组，设置为空数组');\n        this.myApplications = [];\n      }\n    } catch (error) {\n      console.error('[LoanApplicationForm] 加载申请记录失败:', error);\n      this.myApplications = [];\n    } finally {\n      console.log('[LoanApplicationForm] 最终设置的应用记录数量:', this.myApplications.length);\n      this.listLoading = false;\n      m.redraw();\n    }\n  }\n\n  private renderOrderRow(appModel: LoanApplication) {\n    console.log('[LoanApplicationForm] 渲染订单行，应用模型:', appModel);\n\n    // 添加null检查防止TypeError\n    if (!appModel) {\n      console.warn('[LoanApplicationForm] 应用模型为null，跳过渲染');\n      return null;\n    }\n\n    console.log('[LoanApplicationForm] 应用模型详情:', {\n      id: appModel.id?.(),\n      hasId: typeof appModel.id,\n      hasPlatform: typeof appModel.platform,\n      hasSponsorAccount: typeof appModel.sponsorAccount,\n      hasApplicantAccount: typeof appModel.applicantAccount,\n      hasStatus: typeof appModel.status,\n      hasApprovedAmount: typeof appModel.approvedAmount\n    });\n\n    const platform = appModel.platform ? appModel.platform() : null;\n    console.log('[LoanApplicationForm] 平台信息:', platform);\n\n    if (platform) {\n      console.log('[LoanApplicationForm] 平台详情:', {\n        hasName: typeof platform.name,\n        hasLogoUrl: typeof platform.logoUrl,\n        hasCurrencyImageUrl: typeof platform.currencyImageUrl,\n        name: platform.name?.(),\n        logoUrl: platform.logoUrl?.(),\n        currencyImageUrl: platform.currencyImageUrl?.()\n      });\n    }\n\n    const platformName = platform && platform.name ? platform.name() : '-';\n    const platformLogo = platform && platform.logoUrl ? platform.logoUrl() : '';\n    const currencyImg = platform && platform.currencyImageUrl ? platform.currencyImageUrl() : '';\n\n    const sponsor = appModel.sponsorAccount?.() || '-';\n    const applicant = appModel.applicantAccount?.() || '-';\n    const statusText = this.statusText(appModel.status ? appModel.status() : undefined);\n    const amount = appModel.approvedAmount?.();\n\n    console.log('[LoanApplicationForm] 渲染数据:', {\n      platformName,\n      platformLogo,\n      currencyImg,\n      sponsor,\n      applicant,\n      statusText,\n      amount\n    });\n\n    return (\n      <div className=\"OrderList-row\">\n        <div className=\"col-platform\">\n          <span className=\"platform-logo-wrap\">\n            {platformLogo ? <img className=\"platform-logo\" src={platformLogo} alt={platformName} /> : <span className=\"platform-logo placeholder\"></span>}\n          </span>\n          <span className=\"platform-name\">{platformName}</span>\n        </div>\n        <div className=\"col-sponsor\">{sponsor || '-'}</div>\n        <div className=\"col-applicant\">{applicant || '-'}</div>\n        <div className=\"col-status\">{statusText || '-'}</div>\n        <div className=\"col-amount\">\n          {typeof amount === 'number' ? (\n            <span className=\"amount\">\n              {currencyImg ? (\n                <img className=\"currency\" src={currencyImg} alt=\"currency\" />\n              ) : (\n                <span className=\"currency-text\">¥</span>\n              )}\n              <span className=\"value\">{this.formatAmount(amount)}</span>\n            </span>\n          ) : (\n            <span>-</span>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  private statusText(status?: string) {\n    switch (status) {\n      case 'approved':\n        return '已通过';\n      case 'rejected':\n        return '已拒绝';\n      case 'pending':\n      default:\n        return '审核中';\n    }\n  }\n\n  private formatAmount(num: number) {\n    return Number(num).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  }\n}\n","// js/src/forum/components/ApprovedApplicationsList.tsx\nimport Component from 'flarum/common/Component';\nimport m from 'mithril';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\ntype ApprovedApplicationsListAttrs = {\n  applications: LoanApplication[];\n  virtualApprovals: LoanVirtualApproval[];\n};\n\nexport default class ApprovedApplicationsList extends Component<ApprovedApplicationsListAttrs> {\n  private scrollTimer: number | undefined;\n\n    view() {\n    const { applications = [], virtualApprovals = [] } = this.attrs as ApprovedApplicationsListAttrs;\n\n    console.log('[ApprovedApplicationsList] 渲染开始，输入数据:', {\n      applicationsCount: applications.length,\n      virtualApprovalsCount: virtualApprovals.length,\n      applications: applications,\n      virtualApprovals: virtualApprovals\n    });\n\n    // 合并真实和虚拟数据，添加null检查\n    const realApprovals = applications\n      .filter((app: LoanApplication) => {\n        const isValid = app != null && app.id() && app.approvedAmount;\n        if (!isValid) {\n          console.warn('[ApprovedApplicationsList] 过滤掉无效的真实申请:', {\n            app,\n            hasApp: app != null,\n            hasId: app?.id,\n            hasApprovedAmount: app?.approvedAmount\n          });\n        }\n        return isValid;\n      })\n      .map((app: LoanApplication, index) => {\n        console.log(`[ApprovedApplicationsList] 处理真实申请 ${index}:`, app);\n\n        const user = app.user ? app.user() : null;\n        const platform = app.platform ? app.platform() : null;\n\n        console.log(`[ApprovedApplicationsList] 真实申请 ${index} 详情:`, {\n          id: app.id?.(),\n          user: user,\n          platform: platform,\n          username: user ? username(user as any) : null,\n          avatar: user ? avatar(user as any) : null,\n          approvedAmount: app.approvedAmount?.()\n        });\n\n        return {\n          type: 'real',\n          id: app.id(),\n          username: username(user as any) || '',\n          avatar: (avatar(user as any) as any) || null,\n          platform: platform,\n          amount: app.approvedAmount()\n        };\n      });\n\n    const virtualApprovalsProcessed = virtualApprovals\n      .filter((va: LoanVirtualApproval) => {\n        const isValid = va != null && va.id() && va.amount;\n        if (!isValid) {\n          console.warn('[ApprovedApplicationsList] 过滤掉无效的虚拟申请:', {\n            va,\n            hasVa: va != null,\n            hasId: va?.id,\n            hasAmount: va?.amount\n          });\n        }\n        return isValid;\n      })\n      .map((va: LoanVirtualApproval, index) => {\n        console.log(`[ApprovedApplicationsList] 处理虚拟申请 ${index}:`, va);\n\n        const result = {\n          type: 'virtual',\n          id: va.id(),\n          username: va.fakeUsername ? va.fakeUsername() : '',\n          avatar: va.fakeAvatarUrl ? <img src={va.fakeAvatarUrl()} className=\"Avatar\" /> : null,\n          platform: va.platform ? va.platform() : null,\n          amount: va.amount()\n        };\n\n        console.log(`[ApprovedApplicationsList] 虚拟申请 ${index} 处理结果:`, result);\n        return result;\n      });\n\n    const allApprovals = [...realApprovals, ...virtualApprovalsProcessed];\n\n    console.log('[ApprovedApplicationsList] 合并后的数据:', {\n      realCount: realApprovals.length,\n      virtualCount: virtualApprovalsProcessed.length,\n      totalCount: allApprovals.length,\n      allApprovals: allApprovals\n    });\n\n    // 随机排序\n    allApprovals.sort(() => Math.random() - 0.5);\n\n    return (\n      <div className=\"ApprovedApplicationsList Leaderboard\">\n        <div className=\"Leaderboard-header\">\n          <span className=\"col-rank\">段位</span>\n          <span className=\"col-user\">用户</span>\n          <span className=\"col-bet\">下注额</span>\n          <span className=\"col-reward\">奖励</span>\n        </div>\n        <div className=\"Leaderboard-body\" oncreate={this.startAutoScroll.bind(this)} onremove={this.stopAutoScroll.bind(this)}>\n          <div className=\"Leaderboard-scroll\">\n            {allApprovals.map((item, index) => this.renderRow(item, index))}\n            {allApprovals.map((item, index) => this.renderRow(item, index, true))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderRow(approval: any, index: number, clone: boolean = false) {\n    const rank = index + 1;\n    const reward = this.calculateReward(approval.amount);\n    const userName = typeof approval.username === 'string' ? approval.username : '';\n    const avatarNode = approval.avatar ? approval.avatar : <span className=\"Avatar Avatar--placeholder\"></span>;\n    return (\n      <div className={`LeaderRow${clone ? ' clone' : ''}`} key={`${approval.id}-${clone ? 'c' : 'o'}`}>\n        <div className=\"col-rank\">第{rank}名</div>\n        <div className=\"col-user\">\n          <span className=\"user-avatar\">{avatarNode}</span>\n          <span className=\"user-name\">{userName || '隐藏'}</span>\n        </div>\n        <div className=\"col-bet\">\n          <span className=\"currency\">$</span>\n          <span className=\"value\">{this.formatAmount(approval.amount)}</span>\n        </div>\n        <div className=\"col-reward\">\n          <span className=\"btc\">฿</span>\n          <span className=\"value\">{this.formatAmount(reward, 2)}</span>\n        </div>\n      </div>\n    );\n  }\n\n  startAutoScroll(vnode: any) {\n    const container: HTMLElement = vnode.dom as HTMLElement;\n    const inner = container.querySelector('.Leaderboard-scroll') as HTMLElement;\n    if (!container || !inner) return;\n\n    let offset = 0;\n    const step = () => {\n      offset += 0.5; // speed\n      if (offset >= inner.scrollHeight / 2) {\n        offset = 0;\n      }\n      inner.style.transform = `translateY(-${offset}px)`;\n      this.scrollTimer = window.requestAnimationFrame(step) as any;\n    };\n    this.scrollTimer = window.requestAnimationFrame(step) as any;\n  }\n\n  stopAutoScroll() {\n    if (this.scrollTimer) cancelAnimationFrame(this.scrollTimer);\n  }\n\n  calculateReward(amount: number) {\n    // 简化：示例按金额的 0.2% 计算奖励\n    return Math.max(3500, Math.round(amount * 0.002));\n  }\n\n  formatAmount(num: number, fixed?: number) {\n    if (fixed !== undefined) return Number(num).toLocaleString(undefined, { minimumFractionDigits: fixed, maximumFractionDigits: fixed });\n    return Number(num).toLocaleString();\n  }\n}\n","import Component from 'flarum/common/Component';\nimport app from 'flarum/forum/app';\nimport LoanApplicationForm from './LoanApplicationForm';\nimport ApprovedApplicationsList from './ApprovedApplicationsList';\nimport m,{Vnode} from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\nexport default class LoanApplicationPage extends Component {\n  private loading: boolean = false;\n  private platforms: LoanPlatform[] = [];\n  private approvedApplications: LoanApplication[] = [];\n  private virtualApprovals: LoanVirtualApproval[] = [];\n\n  oninit(vnode: Vnode) {\n    console.log('[LoanApplicationPage] 页面组件初始化开始', vnode);\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.platforms = [];\n    this.approvedApplications = [];\n    this.virtualApprovals = [];\n\n    console.log('[LoanApplicationPage] 属性设置完成，开始加载数据');\n    this.loadData();\n  }\n\n    async loadData(): Promise<void> {\n    console.log('[LoanApplicationPage] 开始加载页面数据...');\n    \n    console.log('[LoanApplicationPage] 发起并行API请求...');\n    \n    // 使用 Promise.allSettled 来处理各个请求，即使某个失败也不影响其他\n    const results = await Promise.allSettled([\n      app.store.find('loan-platforms') as any,\n      app.store.find('loan-applications', { filter: { approved: '1' }, include: 'user,platform' } as any) as any,\n      app.store.find('loan-virtual-approvals', { include: 'platform' }) as any\n    ]);\n    \n    // 处理平台数据\n    if (results[0].status === 'fulfilled') {\n      const platforms = results[0].value;\n      this.platforms = Array.isArray(platforms) ? platforms.filter(p => {\n        const isValid = p != null;\n        if (!isValid) console.warn('[LoanApplicationPage] 发现null平台:', p);\n        return isValid;\n      }) : [];\n      console.log('[LoanApplicationPage] 平台加载成功，数量:', this.platforms.length);\n      \n      // 详细检查每个平台\n      this.platforms.forEach((platform, index) => {\n        console.log(`[LoanApplicationPage] 平台 ${index}:`, {\n          id: platform.id?.(),\n          name: platform.name?.(),\n          logoUrl: platform.logoUrl?.(),\n          sponsorLinkUrl: platform.sponsorLinkUrl?.(),\n          currencyImageUrl: platform.currencyImageUrl?.()\n        });\n      });\n    } else {\n      console.error('[LoanApplicationPage] 加载平台失败:', results[0].reason);\n      this.platforms = [];\n    }\n    \n    // 处理已批准申请数据\n    if (results[1].status === 'fulfilled') {\n      const approvedApps = results[1].value;\n      this.approvedApplications = Array.isArray(approvedApps) ? approvedApps.filter(app => {\n        const isValid = app != null;\n        if (!isValid) console.warn('[LoanApplicationPage] 发现null已批准申请:', app);\n        return isValid;\n      }) : [];\n      console.log('[LoanApplicationPage] 已批准申请加载成功，数量:', this.approvedApplications.length);\n    } else {\n      console.error('[LoanApplicationPage] 加载已批准申请失败:', results[1].reason);\n      this.approvedApplications = [];\n    }\n    \n    // 处理虚拟审批数据\n    if (results[2].status === 'fulfilled') {\n      const virtualApprovals = results[2].value;\n      this.virtualApprovals = Array.isArray(virtualApprovals) ? virtualApprovals.filter(v => {\n        const isValid = v != null;\n        if (!isValid) console.warn('[LoanApplicationPage] 发现null虚拟批准:', v);\n        return isValid;\n      }) : [];\n      console.log('[LoanApplicationPage] 虚拟审批加载成功，数量:', this.virtualApprovals.length);\n    } else {\n      console.error('[LoanApplicationPage] 加载虚拟审批失败:', results[2].reason);\n      this.virtualApprovals = [];\n    }\n    \n    console.log('[LoanApplicationPage] 最终数据汇总:', {\n      platformsCount: this.platforms.length,\n      approvedAppsCount: this.approvedApplications.length,\n      virtualApprovalsCount: this.virtualApprovals.length\n    });\n    \n    console.log('[LoanApplicationPage] 数据加载完成，设置loading为false');\n    this.loading = false;\n    m.redraw();\n  }\n\n  view() {\n    if (this.loading) return <div className=\"LoanPage\">加载中...</div>;\n\n    return (\n      <div className=\"LoanPage\">\n        <h2>贷款申请</h2>\n        <LoanApplicationForm\n          platforms={this.platforms}\n          onSubmit={this.submitApplication.bind(this)}\n        />\n\n        <ApprovedApplicationsList\n          applications={this.approvedApplications}\n          virtualApprovals={this.virtualApprovals}\n        />\n      </div>\n    );\n  }\n\n  async submitApplication(payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }): Promise<void> {\n    await app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/loan-applications',\n      body: { data: { attributes: payload } }\n    });\n\n    app.alerts.show({ type: 'success' }, '提交成功，等待审核');\n  }\n}\n","import Model from 'flarum/common/Model';\n\nexport default class LoanPlatform extends Model {\n  name = Model.attribute<string>('name');\n  logoUrl = Model.attribute<string>('logoUrl');\n  sponsorLinkUrl = Model.attribute<string>('sponsorLinkUrl');\n  currencyImageUrl = Model.attribute<string>('currencyImageUrl');\n  sortOrder = Model.attribute<number>('sortOrder');\n}\n","import Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanApplication extends Model {\n  sponsorAccount = Model.attribute<string>('sponsorAccount');\n  applicantAccount = Model.attribute<string>('applicantAccount');\n  status = Model.attribute<string>('status');\n  approvedAmount = Model.attribute<number>('approvedAmount');\n  createdAt = Model.attribute<Date>('createdAt');\n  reviewedAt = Model.attribute<Date>('reviewedAt');\n\n  user = Model.hasOne<User>('user');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import Model from 'flarum/common/Model';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanVirtualApproval extends Model {\n  fakeUsername = Model.attribute<string>('fakeUsername');\n  fakeAvatarUrl = Model.attribute<string>('fakeAvatarUrl');\n  amount = Model.attribute<number>('amount');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import app from 'flarum/forum/app';\nimport LoanApplicationPage from './components/LoanApplicationPage';\nimport LoanPlatform from '../common/models/LoanPlatform';\nimport LoanApplication from '../common/models/LoanApplication';\nimport LoanVirtualApproval from '../common/models/LoanVirtualApproval';\n\napp.initializers.add('wusong8899-loan', () => {\n  app.routes['wusong8899.loan'] = { path: '/loan', component: LoanApplicationPage } as any;\n  app.store.models['loan-platforms'] = LoanPlatform;\n  app.store.models['loan-applications'] = LoanApplication;\n  app.store.models['loan-virtual-approvals'] = LoanVirtualApproval;\n});\n"],"names":["PlatformSelect","Component","m","vnode","platforms","value","list","p","selected","e","index","val","LoanApplicationForm","Stream","selectedPlatform","Button","app","appModel","row","platform","url","result","filteredApps","isValid","error","platformName","platformLogo","currencyImg","sponsor","applicant","statusText","amount","status","num","ApprovedApplicationsList","applications","virtualApprovals","realApprovals","user","username","avatar","virtualApprovalsProcessed","va","allApprovals","item","approval","clone","rank","reward","userName","avatarNode","container","inner","offset","step","fixed","LoanApplicationPage","results","approvedApps","v","payload","LoanPlatform","Model","LoanApplication","LoanVirtualApproval"],"mappings":"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"}