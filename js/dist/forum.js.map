{"version":3,"file":"forum.js","sources":["../src/forum/components/PlatformSelect.tsx","../src/forum/components/LoanApplicationForm.tsx","../src/forum/components/ApprovedApplicationsList.tsx","../src/forum/components/LoanApplicationPage.tsx","../src/common/models/LoanPlatform.ts","../src/common/models/LoanApplication.ts","../src/common/models/LoanVirtualApproval.ts","../src/forum/index.ts"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport m from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype PlatformSelectAttrs = {\n  platforms: LoanPlatform[];\n  value: string;\n  onchange: (val: string) => void;\n};\n\nexport default class PlatformSelect extends Component<PlatformSelectAttrs> {\n  private open = false;\n\n  view() {\n    const { platforms = [], value } = this.attrs as PlatformSelectAttrs;\n    const selected = platforms.find((p) => String(p.id()) === value) || null;\n\n    return (\n      <div className=\"LoanPlatformSelector\" oncreate={() => document.addEventListener('click', this.handleDocClick)} onremove={() => document.removeEventListener('click', this.handleDocClick)}>\n        <div className=\"LoanPlatformSelector-dropdown\" onclick={(e: MouseEvent) => { e.stopPropagation(); this.toggle(); }}>\n          <div className=\"LoanPlatformSelector-selected\">\n            <div className=\"LoanPlatformSelector-info\">\n              <div className=\"LoanPlatformSelector-icon\">\n                {selected ? (\n                  <img className=\"PlatformIcon PlatformIcon--medium\" src={selected.logoUrl()} alt={selected.name()} />\n                ) : (\n                  <span className=\"PlatformIcon PlatformIcon--medium\"></span>\n                )}\n              </div>\n              <div className=\"LoanPlatformSelector-details\">\n                <div className=\"LoanPlatformSelector-name\">{selected ? selected.name() : '请选择平台'}</div>\n              </div>\n            </div>\n          </div>\n          <i className=\"LoanPlatformSelector-dropdownIcon fas fa-chevron-down\"></i>\n        </div>\n\n        {this.open && (\n          <div className=\"LoanPlatformSelector-dropdownMenu\" onclick={(e: MouseEvent) => e.stopPropagation()}>\n            {platforms.length === 0 ? (\n              <div className=\"LoanPlatformSelector-dropdownItem LoanPlatformSelector-noData\">暂无可选平台</div>\n            ) : (\n              platforms.map((p) => (\n                <div className=\"LoanPlatformSelector-dropdownItem\" onclick={() => this.select(String(p.id()))}>\n                  <div className=\"LoanPlatformSelector-icon\">\n                    <img className=\"PlatformIcon PlatformIcon--small\" src={p.logoUrl()} alt={p.name()} />\n                  </div>\n                  <div className=\"LoanPlatformSelector-name\">{p.name()}</div>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  private toggle() {\n    this.open = !this.open;\n  }\n\n  private handleDocClick = () => {\n    if (this.open) {\n      this.open = false;\n      m.redraw();\n    }\n  };\n\n  private select(val: string) {\n    (this.attrs as PlatformSelectAttrs).onchange(val);\n    this.open = false;\n  }\n}\n\n\n","// js/src/forum/components/LoanApplicationForm.tsx\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport PlatformSelect from './PlatformSelect';\nimport Stream from 'flarum/common/utils/Stream';\nimport m,{Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype LoanApplicationFormAttrs = {\n  platforms: LoanPlatform[];\n  onSubmit: (payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }) => Promise<void> | void;\n};\n\nexport default class LoanApplicationForm extends Component<LoanApplicationFormAttrs> {\n  private platformId: any;\n  private sponsorAccount: any;\n  private applicantAccount: any;\n  private loading: boolean = false;\n  private listLoading: boolean = false;\n  private myApplications: LoanApplication[] = [];\n\n  oninit(vnode: Vnode) {\n    super.oninit(vnode);\n\n    this.platformId = Stream('');\n    this.sponsorAccount = Stream('');\n    this.applicantAccount = Stream('');\n    this.loading = false;\n    this.listLoading = true;\n    this.myApplications = [];\n\n    this.loadMyApplications();\n  }\n\n  view() {\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    const selectedPlatform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n\n    return (\n      <div className=\"LoanApplicationForm\">\n        <div className=\"Form-group\">\n          <label>选择平台</label>\n          <PlatformSelect\n            platforms={platforms}\n            value={this.platformId()}\n            onchange={this.platformId}\n          />\n        </div>\n\n        <div className=\"Form-twoInputs\">\n          <div className=\"Form-group\">\n            <label>赞助平台账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.sponsorAccount()}\n              oninput={(e: InputEvent) => this.sponsorAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：平台用户名/ID\"\n            />\n            <Button\n              className=\"Button\"\n              disabled={!selectedPlatform || !selectedPlatform.sponsorLinkUrl?.()}\n              onclick={this.openSponsorLink.bind(this)}\n            >\n              打开赞助平台链接\n            </Button>\n          </div>\n          <div className=\"Form-group\">\n            <label>申请账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.applicantAccount()}\n              oninput={(e: InputEvent) => this.applicantAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：论坛或应用内账号\"\n            />\n            <Button\n              className=\"Button Button--primary\"\n              loading={this.loading}\n              disabled={!this.platformId() || !this.sponsorAccount() || !this.applicantAccount()}\n              onclick={this.submit.bind(this)}\n            >\n              提交申请\n            </Button>\n          </div>\n        </div>\n        <div className=\"MyApplications\">\n          <h3>您的申请订单</h3>\n          {this.listLoading ? (\n            <div>加载中...</div>\n          ) : (\n            <div className=\"OrderList\">\n              <div className=\"OrderList-header\">\n                <span>平台</span>\n                <span>赞助账号</span>\n                <span>申请账号</span>\n                <span>状态</span>\n                <span>批准额度</span>\n              </div>\n              <div className=\"OrderList-body\">\n                {Array.isArray(this.myApplications) && this.myApplications.length > 0 ? (\n                  (this.myApplications as LoanApplication[])\n                    .filter((a) => !!a)\n                    .map((appModel: LoanApplication) => this.renderOrderRow(appModel))\n                ) : (\n                  <div className=\"OrderList-empty\">暂无记录</div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  async submit(): Promise<void> {\n    if (this.loading) return;\n\n    this.loading = true;\n\n    try {\n      await (this.attrs as LoanApplicationFormAttrs).onSubmit({\n        platform_id: this.platformId(),\n        sponsor_account: this.sponsorAccount(),\n        applicant_account: this.applicantAccount()\n      });\n\n      // 重置表单\n      this.platformId('');\n      this.sponsorAccount('');\n      this.applicantAccount('');\n\n      // 重新加载我的申请记录\n      await this.loadMyApplications();\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  openSponsorLink() {\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    const platform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n    const url = platform && platform.sponsorLinkUrl ? platform.sponsorLinkUrl() : null;\n    if (url) {\n      window.open(url, '_blank');\n    }\n  }\n\n  async loadMyApplications(): Promise<void> {\n    try {\n      this.myApplications = await app.store.find('loan-applications') as any;\n    } finally {\n      this.listLoading = false;\n      m.redraw();\n    }\n  }\n\n  private renderOrderRow(appModel: LoanApplication) {\n    const platform = appModel.platform() as any;\n    const platformName = platform && platform.name ? platform.name() : '-';\n    const platformLogo = platform && platform.logoUrl ? platform.logoUrl() : null;\n    const currencyImg = platform && platform.currencyImageUrl ? platform.currencyImageUrl() : null;\n\n    const sponsor = appModel.sponsorAccount?.() || '-';\n    const applicant = appModel.applicantAccount?.() || '-';\n    const statusText = this.statusText(appModel.status());\n    const amount = appModel.approvedAmount?.();\n\n    return (\n      <div className=\"OrderList-row\">\n        <div className=\"col-platform\">\n          <span className=\"platform-logo-wrap\">\n            {platformLogo ? <img className=\"platform-logo\" src={platformLogo} alt={platformName} /> : <span className=\"platform-logo placeholder\"></span>}\n          </span>\n          <span className=\"platform-name\">{platformName}</span>\n        </div>\n        <div className=\"col-sponsor\">{sponsor || '-'}</div>\n        <div className=\"col-applicant\">{applicant || '-'}</div>\n        <div className=\"col-status\">{statusText || '-'}</div>\n        <div className=\"col-amount\">\n          {typeof amount === 'number' ? (\n            <span className=\"amount\">\n              {currencyImg ? (\n                <img className=\"currency\" src={currencyImg} alt=\"currency\" />\n              ) : (\n                <span className=\"currency-text\">¥</span>\n              )}\n              <span className=\"value\">{this.formatAmount(amount)}</span>\n            </span>\n          ) : (\n            <span>-</span>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  private statusText(status?: string) {\n    switch (status) {\n      case 'approved':\n        return '已通过';\n      case 'rejected':\n        return '已拒绝';\n      case 'pending':\n      default:\n        return '审核中';\n    }\n  }\n\n  private formatAmount(num: number) {\n    return Number(num).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  }\n}\n","// js/src/forum/components/ApprovedApplicationsList.tsx\nimport Component from 'flarum/common/Component';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\ntype ApprovedApplicationsListAttrs = {\n  applications: LoanApplication[];\n  virtualApprovals: LoanVirtualApproval[];\n};\n\nexport default class ApprovedApplicationsList extends Component<ApprovedApplicationsListAttrs> {\n  private scrollTimer: number | undefined;\n\n  view() {\n    const { applications = [], virtualApprovals = [] } = this.attrs as ApprovedApplicationsListAttrs;\n\n    // 合并真实和虚拟数据\n    const allApprovals = [\n      ...applications.map((app: LoanApplication) => ({\n        type: 'real',\n        id: app.id(),\n        username: username((app.user() || null) as any) || '',\n        avatar: (avatar((app.user() || null) as any) as any) || null,\n        platform: app.platform() as any,\n        amount: app.approvedAmount()\n      })),\n      ...virtualApprovals.map((va: LoanVirtualApproval) => ({\n        type: 'virtual',\n        id: va.id(),\n        username: va.fakeUsername() || '',\n        avatar: <img src={va.fakeAvatarUrl()} className=\"Avatar\" />,\n        platform: va.platform(),\n        amount: va.amount()\n      }))\n    ];\n\n    // 随机排序\n    allApprovals.sort(() => Math.random() - 0.5);\n\n    return (\n      <div className=\"ApprovedApplicationsList Leaderboard\">\n        <div className=\"Leaderboard-header\">\n          <span className=\"col-rank\">段位</span>\n          <span className=\"col-user\">用户</span>\n          <span className=\"col-bet\">下注额</span>\n          <span className=\"col-reward\">奖励</span>\n        </div>\n        <div className=\"Leaderboard-body\" oncreate={this.startAutoScroll.bind(this)} onremove={this.stopAutoScroll.bind(this)}>\n          <div className=\"Leaderboard-scroll\">\n            {allApprovals.map((item, index) => this.renderRow(item, index))}\n            {allApprovals.map((item, index) => this.renderRow(item, index, true))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderRow(approval: any, index: number, clone: boolean = false) {\n    const rank = index + 1;\n    const reward = this.calculateReward(approval.amount);\n    const userName = typeof approval.username === 'string' ? approval.username : '';\n    const avatarNode = approval.avatar ? approval.avatar : <span className=\"Avatar Avatar--placeholder\"></span>;\n    return (\n      <div className={`LeaderRow${clone ? ' clone' : ''}`} key={`${approval.id}-${clone ? 'c' : 'o'}`}>\n        <div className=\"col-rank\">第{rank}名</div>\n        <div className=\"col-user\">\n          <span className=\"user-avatar\">{avatarNode}</span>\n          <span className=\"user-name\">{userName || '隐藏'}</span>\n        </div>\n        <div className=\"col-bet\">\n          <span className=\"currency\">$</span>\n          <span className=\"value\">{this.formatAmount(approval.amount)}</span>\n        </div>\n        <div className=\"col-reward\">\n          <span className=\"btc\">฿</span>\n          <span className=\"value\">{this.formatAmount(reward, 2)}</span>\n        </div>\n      </div>\n    );\n  }\n\n  startAutoScroll(vnode: any) {\n    const container: HTMLElement = vnode.dom as HTMLElement;\n    const inner = container.querySelector('.Leaderboard-scroll') as HTMLElement;\n    if (!container || !inner) return;\n\n    let offset = 0;\n    const step = () => {\n      offset += 0.5; // speed\n      if (offset >= inner.scrollHeight / 2) {\n        offset = 0;\n      }\n      inner.style.transform = `translateY(-${offset}px)`;\n      this.scrollTimer = window.requestAnimationFrame(step) as any;\n    };\n    this.scrollTimer = window.requestAnimationFrame(step) as any;\n  }\n\n  stopAutoScroll() {\n    if (this.scrollTimer) cancelAnimationFrame(this.scrollTimer);\n  }\n\n  calculateReward(amount: number) {\n    // 简化：示例按金额的 0.2% 计算奖励\n    return Math.max(3500, Math.round(amount * 0.002));\n  }\n\n  formatAmount(num: number, fixed?: number) {\n    if (fixed !== undefined) return Number(num).toLocaleString(undefined, { minimumFractionDigits: fixed, maximumFractionDigits: fixed });\n    return Number(num).toLocaleString();\n  }\n}\n","import Component from 'flarum/common/Component';\nimport app from 'flarum/forum/app';\nimport LoanApplicationForm from './LoanApplicationForm';\nimport ApprovedApplicationsList from './ApprovedApplicationsList';\nimport m,{Vnode} from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\nexport default class LoanApplicationPage extends Component {\n  private loading: boolean = false;\n  private platforms: LoanPlatform[] = [];\n  private approvedApplications: LoanApplication[] = [];\n  private virtualApprovals: LoanVirtualApproval[] = [];\n\n  oninit(vnode: Vnode) {\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.platforms = [];\n    this.approvedApplications = [];\n    this.virtualApprovals = [];\n\n    this.loadData();\n  }\n\n  async loadData(): Promise<void> {\n    try {\n      this.platforms = await app.store.find('loan-platforms') as any;\n      this.approvedApplications = await app.store.find('loan-applications', { filter: { approved: '1' } } as any) as any;\n      this.virtualApprovals = await app.store.find('loan-virtual-approvals') as any;\n    } finally {\n      this.loading = false;\n      m.redraw();\n    }\n  }\n\n  view() {\n    if (this.loading) return <div className=\"LoanPage\">加载中...</div>;\n\n    return (\n      <div className=\"LoanPage\">\n        <h2>贷款申请</h2>\n        <LoanApplicationForm\n          platforms={this.platforms}\n          onSubmit={this.submitApplication.bind(this)}\n        />\n\n        <ApprovedApplicationsList\n          applications={this.approvedApplications}\n          virtualApprovals={this.virtualApprovals}\n        />\n      </div>\n    );\n  }\n\n  async submitApplication(payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }): Promise<void> {\n    await app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/loan-applications',\n      body: { data: { attributes: payload } }\n    });\n\n    app.alerts.show({ type: 'success' }, '提交成功，等待审核');\n  }\n}\n","import Model from 'flarum/common/Model';\n\nexport default class LoanPlatform extends Model {\n  name = Model.attribute<string>('name');\n  logoUrl = Model.attribute<string>('logoUrl');\n  sponsorLinkUrl = Model.attribute<string>('sponsorLinkUrl');\n  currencyImageUrl = Model.attribute<string>('currencyImageUrl');\n  sortOrder = Model.attribute<number>('sortOrder');\n}\n","import Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanApplication extends Model {\n  sponsorAccount = Model.attribute<string>('sponsorAccount');\n  applicantAccount = Model.attribute<string>('applicantAccount');\n  status = Model.attribute<string>('status');\n  approvedAmount = Model.attribute<number>('approvedAmount');\n  createdAt = Model.attribute<Date>('createdAt');\n  reviewedAt = Model.attribute<Date>('reviewedAt');\n\n  user = Model.hasOne<User>('user');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import Model from 'flarum/common/Model';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanVirtualApproval extends Model {\n  fakeUsername = Model.attribute<string>('fakeUsername');\n  fakeAvatarUrl = Model.attribute<string>('fakeAvatarUrl');\n  amount = Model.attribute<number>('amount');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import app from 'flarum/forum/app';\nimport LoanApplicationPage from './components/LoanApplicationPage';\nimport LoanPlatform from '../common/models/LoanPlatform';\nimport LoanApplication from '../common/models/LoanApplication';\nimport LoanVirtualApproval from '../common/models/LoanVirtualApproval';\n\napp.initializers.add('wusong8899-loan', () => {\n  app.routes['wusong8899.loan'] = { path: '/loan', component: LoanApplicationPage } as any;\n  app.store.models['loan-platforms'] = LoanPlatform;\n  app.store.models['loan-applications'] = LoanApplication;\n  app.store.models['loan-virtual-approvals'] = LoanVirtualApproval;\n});\n"],"names":["PlatformSelect","Component","m","platforms","value","selected","p","e","val","LoanApplicationForm","vnode","Stream","selectedPlatform","Button","a","appModel","platform","url","app","platformName","platformLogo","currencyImg","sponsor","applicant","statusText","amount","status","num","ApprovedApplicationsList","applications","virtualApprovals","allApprovals","username","avatar","va","item","index","approval","clone","rank","reward","userName","avatarNode","container","inner","offset","step","fixed","LoanApplicationPage","payload","LoanPlatform","Model","LoanApplication","LoanVirtualApproval"],"mappings":"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"}