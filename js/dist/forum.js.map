{"version":3,"file":"forum.js","sources":["../src/forum/components/PlatformSelect.tsx","../src/forum/components/LoanApplicationForm.tsx","../src/forum/components/ApprovedApplicationsList.tsx","../src/forum/components/LoanApplicationPage.tsx","../src/common/models/LoanPlatform.ts","../src/common/models/LoanApplication.ts","../src/common/models/LoanVirtualApproval.ts","../src/forum/index.ts"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport m, { VnodeDOM } from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype PlatformSelectAttrs = {\n  platforms: LoanPlatform[];\n  value: string;\n  onchange: (val: string) => void;\n};\n\nexport default class PlatformSelect extends Component<PlatformSelectAttrs> {\n  private open = false;\n\n  oncreate(vnode: VnodeDOM) {\n    super.oncreate(vnode);\n    document.addEventListener('click', this.handleDocClick);\n  }\n\n  onremove(vnode: VnodeDOM) {\n    super.onremove(vnode);\n    document.removeEventListener('click', this.handleDocClick);\n  }\n\n  view() {\n    const { platforms = [], value } = this.attrs as PlatformSelectAttrs;\n    const list = Array.isArray(platforms)\n      ? platforms.filter((p) => p && typeof (p as any).id === 'function' && (p as any).id() != null)\n      : [];\n    const selected = list.find((p) => String(p.id()) === value) || null;\n\n    return (\n      <div className=\"LoanPlatformSelector\">\n        <div className=\"LoanPlatformSelector-dropdown\" onclick={(e: MouseEvent) => { e.stopPropagation(); this.toggle(); }}>\n          <div className=\"LoanPlatformSelector-selected\">\n            <div className=\"LoanPlatformSelector-info\">\n              <div className=\"LoanPlatformSelector-icon\">\n                {selected ? (\n                  <img className=\"PlatformIcon PlatformIcon--medium\" src={selected.logoUrl()} alt={selected.name()} />\n                ) : (\n                  <span className=\"PlatformIcon PlatformIcon--medium PlatformIcon--placeholder\"></span>\n                )}\n              </div>\n              <div className=\"LoanPlatformSelector-details\">\n                <div className=\"LoanPlatformSelector-name\">{selected ? selected.name() : '请选择平台'}</div>\n              </div>\n            </div>\n            <i className={`LoanPlatformSelector-dropdownIcon fas fa-chevron-${this.open ? 'up' : 'down'}`}></i>\n          </div>\n        </div>\n\n        {this.open && (\n          <div className=\"LoanPlatformSelector-dropdownMenu\" onclick={(e: MouseEvent) => e.stopPropagation()}>\n            {list.length === 0 ? (\n              <div className=\"LoanPlatformSelector-dropdownItem LoanPlatformSelector-noData\">暂无可选平台</div>\n            ) : (\n              list.map((p, index) => (\n                <div\n                  key={String((p as any).id() ?? index)}\n                  className=\"LoanPlatformSelector-dropdownItem\"\n                  onclick={() => this.select(String((p as any).id()))}\n                >\n                  <div className=\"LoanPlatformSelector-icon\">\n                    <img className=\"PlatformIcon PlatformIcon--small\" src={(p as any).logoUrl()} alt={(p as any).name()} />\n                  </div>\n                  <div className=\"LoanPlatformSelector-name\">{(p as any).name()}</div>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  private toggle() {\n    this.open = !this.open;\n    m.redraw();\n  }\n\n  private handleDocClick = () => {\n    if (this.open) {\n      this.open = false;\n      m.redraw();\n    }\n  };\n\n  private select(val: string) {\n    (this.attrs as PlatformSelectAttrs).onchange(val);\n    this.open = false;\n    m.redraw();\n  }\n}\n\n\n","// js/src/forum/components/LoanApplicationForm.tsx\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport PlatformSelect from './PlatformSelect';\nimport Stream from 'flarum/common/utils/Stream';\nimport m,{Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanPlatform from '../../common/models/LoanPlatform';\n\ntype LoanApplicationFormAttrs = {\n  platforms: LoanPlatform[];\n  onSubmit: (payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }) => Promise<void> | void;\n};\n\nexport default class LoanApplicationForm extends Component<LoanApplicationFormAttrs> {\n  private platformId: any;\n  private sponsorAccount: any;\n  private applicantAccount: any;\n  private loading: boolean = false;\n  private listLoading: boolean = false;\n  private myApplications: LoanApplication[] = [];\n\n  oninit(vnode: Vnode) {\n    super.oninit(vnode);\n\n    this.platformId = Stream('');\n    this.sponsorAccount = Stream('');\n    this.applicantAccount = Stream('');\n    this.loading = false;\n    this.listLoading = true;\n    this.myApplications = [];\n\n    this.loadMyApplications();\n  }\n\n  view() {\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    const selectedPlatform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n\n    return (\n      <div className=\"LoanApplicationForm\">\n        <div className=\"Form-group\">\n          <label>选择平台</label>\n          <PlatformSelect\n            platforms={platforms}\n            value={this.platformId()}\n            onchange={this.platformId}\n          />\n        </div>\n\n        <div className=\"Form-twoInputs\">\n          <div className=\"Form-group\">\n            <label>赞助平台账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.sponsorAccount()}\n              oninput={(e: InputEvent) => this.sponsorAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：平台用户名/ID\"\n            />\n            <Button\n              className=\"Button\"\n              disabled={!selectedPlatform || !selectedPlatform.sponsorLinkUrl?.()}\n              onclick={this.openSponsorLink.bind(this)}\n            >\n              打开赞助平台链接\n            </Button>\n          </div>\n          <div className=\"Form-group\">\n            <label>申请账号</label>\n            <input\n              className=\"FormControl\"\n              value={this.applicantAccount()}\n              oninput={(e: InputEvent) => this.applicantAccount((e.target as HTMLInputElement).value)}\n              placeholder=\"例如：论坛或应用内账号\"\n            />\n            <Button\n              className=\"Button Button--primary\"\n              loading={this.loading}\n              disabled={!this.platformId() || !this.sponsorAccount() || !this.applicantAccount()}\n              onclick={this.submit.bind(this)}\n            >\n              提交申请\n            </Button>\n          </div>\n        </div>\n        <div className=\"MyApplications\">\n          <h3>您的申请订单</h3>\n          {this.listLoading ? (\n            <div>加载中...</div>\n          ) : (\n            <div className=\"OrderList\">\n              <div className=\"OrderList-header\">\n                <span>平台</span>\n                <span>赞助账号</span>\n                <span>申请账号</span>\n                <span>状态</span>\n                <span>批准额度</span>\n              </div>\n              <div className=\"OrderList-body\">\n                {Array.isArray(this.myApplications) && this.myApplications.length > 0 ? (\n                  (this.myApplications as LoanApplication[])\n                    .filter((a) => !!a)\n                    .map((appModel: LoanApplication) => this.renderOrderRow(appModel))\n                    .filter((row) => row !== null) // 过滤掉renderOrderRow返回的null值\n                ) : (\n                  <div className=\"OrderList-empty\">暂无记录</div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  async submit(): Promise<void> {\n    if (this.loading) return;\n\n    this.loading = true;\n\n    try {\n      await (this.attrs as LoanApplicationFormAttrs).onSubmit({\n        platform_id: this.platformId(),\n        sponsor_account: this.sponsorAccount(),\n        applicant_account: this.applicantAccount()\n      });\n\n      // 重置表单\n      this.platformId('');\n      this.sponsorAccount('');\n      this.applicantAccount('');\n\n      // 重新加载我的申请记录\n      await this.loadMyApplications();\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  openSponsorLink() {\n    const platforms = (this.attrs as LoanApplicationFormAttrs).platforms || [];\n    const platform = platforms.find((p: LoanPlatform) => String(p.id()) === this.platformId());\n    const url = platform && platform.sponsorLinkUrl ? platform.sponsorLinkUrl() : null;\n    if (url) {\n      window.open(url, '_blank');\n    }\n  }\n\n  async loadMyApplications(): Promise<void> {\n    try {\n      const result = await app.store.find('loan-applications') as any;\n      // 确保结果是数组，过滤掉任何null/undefined值\n      this.myApplications = Array.isArray(result) ? result.filter(app => app != null) : [];\n    } catch (error) {\n      console.error('Failed to load loan applications:', error);\n      this.myApplications = [];\n    } finally {\n      this.listLoading = false;\n      m.redraw();\n    }\n  }\n\n  private renderOrderRow(appModel: LoanApplication) {\n    // 添加null检查防止TypeError\n    if (!appModel) {\n      return null;\n    }\n\n    const platform = appModel.platform ? appModel.platform() : null;\n    const platformName = platform && platform.name ? platform.name() : '-';\n    const platformLogo = platform && platform.logoUrl ? platform.logoUrl() : '';\n    const currencyImg = platform && platform.currencyImageUrl ? platform.currencyImageUrl() : '';\n\n    const sponsor = appModel.sponsorAccount?.() || '-';\n    const applicant = appModel.applicantAccount?.() || '-';\n    const statusText = this.statusText(appModel.status ? appModel.status() : undefined);\n    const amount = appModel.approvedAmount?.();\n\n    return (\n      <div className=\"OrderList-row\">\n        <div className=\"col-platform\">\n          <span className=\"platform-logo-wrap\">\n            {platformLogo ? <img className=\"platform-logo\" src={platformLogo} alt={platformName} /> : <span className=\"platform-logo placeholder\"></span>}\n          </span>\n          <span className=\"platform-name\">{platformName}</span>\n        </div>\n        <div className=\"col-sponsor\">{sponsor || '-'}</div>\n        <div className=\"col-applicant\">{applicant || '-'}</div>\n        <div className=\"col-status\">{statusText || '-'}</div>\n        <div className=\"col-amount\">\n          {typeof amount === 'number' ? (\n            <span className=\"amount\">\n              {currencyImg ? (\n                <img className=\"currency\" src={currencyImg} alt=\"currency\" />\n              ) : (\n                <span className=\"currency-text\">¥</span>\n              )}\n              <span className=\"value\">{this.formatAmount(amount)}</span>\n            </span>\n          ) : (\n            <span>-</span>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  private statusText(status?: string) {\n    switch (status) {\n      case 'approved':\n        return '已通过';\n      case 'rejected':\n        return '已拒绝';\n      case 'pending':\n      default:\n        return '审核中';\n    }\n  }\n\n  private formatAmount(num: number) {\n    return Number(num).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n  }\n}\n","// js/src/forum/components/ApprovedApplicationsList.tsx\nimport Component from 'flarum/common/Component';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\ntype ApprovedApplicationsListAttrs = {\n  applications: LoanApplication[];\n  virtualApprovals: LoanVirtualApproval[];\n};\n\nexport default class ApprovedApplicationsList extends Component<ApprovedApplicationsListAttrs> {\n  private scrollTimer: number | undefined;\n\n  view() {\n    const { applications = [], virtualApprovals = [] } = this.attrs as ApprovedApplicationsListAttrs;\n\n    // 合并真实和虚拟数据，添加null检查\n    const allApprovals = [\n      ...applications\n        .filter((app: LoanApplication) => app != null && app.id && app.approvedAmount) // 过滤null和无效数据\n        .map((app: LoanApplication) => {\n          const user = app.user ? app.user() : null;\n          const platform = app.platform ? app.platform() : null;\n\n          return {\n            type: 'real',\n            id: app.id(),\n            username: username(user as any) || '',\n            avatar: (avatar(user as any) as any) || null,\n            platform: platform,\n            amount: app.approvedAmount()\n          };\n        }),\n      ...virtualApprovals\n        .filter((va: LoanVirtualApproval) => va != null && va.id && va.amount) // 过滤null和无效数据\n        .map((va: LoanVirtualApproval) => ({\n          type: 'virtual',\n          id: va.id(),\n          username: va.fakeUsername ? va.fakeUsername() : '',\n          avatar: va.fakeAvatarUrl ? <img src={va.fakeAvatarUrl()} className=\"Avatar\" /> : null,\n          platform: va.platform ? va.platform() : null,\n          amount: va.amount()\n        }))\n    ];\n\n    // 随机排序\n    allApprovals.sort(() => Math.random() - 0.5);\n\n    return (\n      <div className=\"ApprovedApplicationsList Leaderboard\">\n        <div className=\"Leaderboard-header\">\n          <span className=\"col-rank\">段位</span>\n          <span className=\"col-user\">用户</span>\n          <span className=\"col-bet\">下注额</span>\n          <span className=\"col-reward\">奖励</span>\n        </div>\n        <div className=\"Leaderboard-body\" oncreate={this.startAutoScroll.bind(this)} onremove={this.stopAutoScroll.bind(this)}>\n          <div className=\"Leaderboard-scroll\">\n            {allApprovals.map((item, index) => this.renderRow(item, index))}\n            {allApprovals.map((item, index) => this.renderRow(item, index, true))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderRow(approval: any, index: number, clone: boolean = false) {\n    const rank = index + 1;\n    const reward = this.calculateReward(approval.amount);\n    const userName = typeof approval.username === 'string' ? approval.username : '';\n    const avatarNode = approval.avatar ? approval.avatar : <span className=\"Avatar Avatar--placeholder\"></span>;\n    return (\n      <div className={`LeaderRow${clone ? ' clone' : ''}`} key={`${approval.id}-${clone ? 'c' : 'o'}`}>\n        <div className=\"col-rank\">第{rank}名</div>\n        <div className=\"col-user\">\n          <span className=\"user-avatar\">{avatarNode}</span>\n          <span className=\"user-name\">{userName || '隐藏'}</span>\n        </div>\n        <div className=\"col-bet\">\n          <span className=\"currency\">$</span>\n          <span className=\"value\">{this.formatAmount(approval.amount)}</span>\n        </div>\n        <div className=\"col-reward\">\n          <span className=\"btc\">฿</span>\n          <span className=\"value\">{this.formatAmount(reward, 2)}</span>\n        </div>\n      </div>\n    );\n  }\n\n  startAutoScroll(vnode: any) {\n    const container: HTMLElement = vnode.dom as HTMLElement;\n    const inner = container.querySelector('.Leaderboard-scroll') as HTMLElement;\n    if (!container || !inner) return;\n\n    let offset = 0;\n    const step = () => {\n      offset += 0.5; // speed\n      if (offset >= inner.scrollHeight / 2) {\n        offset = 0;\n      }\n      inner.style.transform = `translateY(-${offset}px)`;\n      this.scrollTimer = window.requestAnimationFrame(step) as any;\n    };\n    this.scrollTimer = window.requestAnimationFrame(step) as any;\n  }\n\n  stopAutoScroll() {\n    if (this.scrollTimer) cancelAnimationFrame(this.scrollTimer);\n  }\n\n  calculateReward(amount: number) {\n    // 简化：示例按金额的 0.2% 计算奖励\n    return Math.max(3500, Math.round(amount * 0.002));\n  }\n\n  formatAmount(num: number, fixed?: number) {\n    if (fixed !== undefined) return Number(num).toLocaleString(undefined, { minimumFractionDigits: fixed, maximumFractionDigits: fixed });\n    return Number(num).toLocaleString();\n  }\n}\n","import Component from 'flarum/common/Component';\nimport app from 'flarum/forum/app';\nimport LoanApplicationForm from './LoanApplicationForm';\nimport ApprovedApplicationsList from './ApprovedApplicationsList';\nimport m,{Vnode} from 'mithril';\nimport LoanPlatform from '../../common/models/LoanPlatform';\nimport LoanApplication from '../../common/models/LoanApplication';\nimport LoanVirtualApproval from '../../common/models/LoanVirtualApproval';\n\nexport default class LoanApplicationPage extends Component {\n  private loading: boolean = false;\n  private platforms: LoanPlatform[] = [];\n  private approvedApplications: LoanApplication[] = [];\n  private virtualApprovals: LoanVirtualApproval[] = [];\n\n  oninit(vnode: Vnode) {\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.platforms = [];\n    this.approvedApplications = [];\n    this.virtualApprovals = [];\n\n    this.loadData();\n  }\n\n  async loadData(): Promise<void> {\n    try {\n      const [platforms, approvedApps, virtualApprovals] = await Promise.all([\n        app.store.find('loan-platforms') as any,\n        app.store.find('loan-applications', { filter: { approved: '1' } } as any) as any,\n        app.store.find('loan-virtual-approvals') as any\n      ]);\n\n      // 确保所有结果都是数组，过滤掉null/undefined值\n      this.platforms = Array.isArray(platforms) ? platforms.filter(p => p != null) : [];\n      this.approvedApplications = Array.isArray(approvedApps) ? approvedApps.filter(app => app != null) : [];\n      this.virtualApprovals = Array.isArray(virtualApprovals) ? virtualApprovals.filter(v => v != null) : [];\n    } catch (error) {\n      console.error('Failed to load loan data:', error);\n      // 设置默认的空数组\n      this.platforms = [];\n      this.approvedApplications = [];\n      this.virtualApprovals = [];\n    } finally {\n      this.loading = false;\n      m.redraw();\n    }\n  }\n\n  view() {\n    if (this.loading) return <div className=\"LoanPage\">加载中...</div>;\n\n    return (\n      <div className=\"LoanPage\">\n        <h2>贷款申请</h2>\n        <LoanApplicationForm\n          platforms={this.platforms}\n          onSubmit={this.submitApplication.bind(this)}\n        />\n\n        <ApprovedApplicationsList\n          applications={this.approvedApplications}\n          virtualApprovals={this.virtualApprovals}\n        />\n      </div>\n    );\n  }\n\n  async submitApplication(payload: { platform_id: string; sponsor_account?: string; applicant_account?: string }): Promise<void> {\n    await app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/loan-applications',\n      body: { data: { attributes: payload } }\n    });\n\n    app.alerts.show({ type: 'success' }, '提交成功，等待审核');\n  }\n}\n","import Model from 'flarum/common/Model';\n\nexport default class LoanPlatform extends Model {\n  name = Model.attribute<string>('name');\n  logoUrl = Model.attribute<string>('logoUrl');\n  sponsorLinkUrl = Model.attribute<string>('sponsorLinkUrl');\n  currencyImageUrl = Model.attribute<string>('currencyImageUrl');\n  sortOrder = Model.attribute<number>('sortOrder');\n}\n","import Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanApplication extends Model {\n  sponsorAccount = Model.attribute<string>('sponsorAccount');\n  applicantAccount = Model.attribute<string>('applicantAccount');\n  status = Model.attribute<string>('status');\n  approvedAmount = Model.attribute<number>('approvedAmount');\n  createdAt = Model.attribute<Date>('createdAt');\n  reviewedAt = Model.attribute<Date>('reviewedAt');\n\n  user = Model.hasOne<User>('user');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import Model from 'flarum/common/Model';\nimport LoanPlatform from './LoanPlatform';\n\nexport default class LoanVirtualApproval extends Model {\n  fakeUsername = Model.attribute<string>('fakeUsername');\n  fakeAvatarUrl = Model.attribute<string>('fakeAvatarUrl');\n  amount = Model.attribute<number>('amount');\n  platform = Model.hasOne<LoanPlatform>('platform');\n}\n","import app from 'flarum/forum/app';\nimport LoanApplicationPage from './components/LoanApplicationPage';\nimport LoanPlatform from '../common/models/LoanPlatform';\nimport LoanApplication from '../common/models/LoanApplication';\nimport LoanVirtualApproval from '../common/models/LoanVirtualApproval';\n\napp.initializers.add('wusong8899-loan', () => {\n  app.routes['wusong8899.loan'] = { path: '/loan', component: LoanApplicationPage } as any;\n  app.store.models['loan-platforms'] = LoanPlatform;\n  app.store.models['loan-applications'] = LoanApplication;\n  app.store.models['loan-virtual-approvals'] = LoanVirtualApproval;\n});\n"],"names":["PlatformSelect","Component","m","vnode","platforms","value","list","p","selected","index","val","LoanApplicationForm","Stream","selectedPlatform","e","Button","a","appModel","row","platform","url","result","app","error","platformName","platformLogo","currencyImg","sponsor","applicant","statusText","amount","status","num","ApprovedApplicationsList","applications","virtualApprovals","allApprovals","user","username","avatar","va","item","approval","clone","rank","reward","userName","avatarNode","container","inner","offset","step","fixed","LoanApplicationPage","approvedApps","v","payload","LoanPlatform","Model","LoanApplication","LoanVirtualApproval"],"mappings":"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"}